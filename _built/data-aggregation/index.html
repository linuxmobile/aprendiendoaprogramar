<!doctype html><html domain=.com lang=en><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content="" http-equiv=Content-Security-Policy><link href=/favicon.svg rel=icon type=image/svg+xml><meta content=#f9c412 name=theme-color><meta content="max-snippet:-1, max-image-preview: large, max-video-preview: -1" name=robots><title>Data Aggregation | Note of Thi</title><meta content="Data Aggregation | Note of Thi" prefix=og:http://ogp.me/ns# property=og:title><meta content="In this note, I use df for DataFrame, s for Series. Libraries import pandas as pd # import pandas packageimport numpy as np Dataframe..." name=description><meta content="In this note, I use df for DataFrame, s for Series. Libraries import pandas as pd # import pandas packageimport numpy as np Dataframe..." prefix=og:http://ogp.me/ns# property=og:description><meta content=summary_large_image name=twitter:card><meta content=@dinhanhthi name=twitter:site><meta content=@dinhanhthi name=twitter:creator><meta content=https://dinhanhthi.com/img_src/cover.png prefix=og:http://ogp.me/ns# property=og:image><meta content=article prefix=og:http://ogp.me/ns# property=og:type><link href=https://dinhanhthi.com/data-aggregation/ rel=canonical><meta content=https://dinhanhthi.com/data-aggregation/ prefix=og:http://ogp.me/ns# property=og:url><meta content=no-referrer-when-downgrade name=referrer><link href=/feed/feed.xml rel=alternate type=application/atom+xml title="ðŸ”¥ Anh-Thi DINH"><link href=/ rel=preconnect crossorigin><style>body {
      visibility: hidden;
      opacity: 0;
    }</style><noscript><style>body {
        visibility: visible;
        opacity: 1;
      }</style></noscript><script csp-hash>if (/Mac OS X/.test(navigator.userAgent))
      document
        .documentElement
        .classList
        .add('apple')</script><link href=/src/css/main.css rel=stylesheet type=text/css><style>@font-face{font-display:swap;font-family:'fontello';src:url(/fontello/font/fontello.eot?46432155);src:url(/fontello/font/fontello.eot?46432155#iefix) format('embedded-opentype'),url(/fontello/font/fontello.woff2?46432155) format('woff2'),url(/fontello/font/fontello.woff?46432155) format('woff'),url(/fontello/font/fontello.ttf?46432155) format('truetype'),url(/fontello/font/fontello.svg?46432155#fontello) format('svg');font-weight:400;font-style:normal}[class*=" icon-"]:before,[class^=icon-]:before{font-family:"fontello";font-style:normal;font-weight:400;speak:never;display:inline-block;text-decoration:inherit;width:1em;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-doc:before{content:'\e800'}.icon-doc-add:before{content:'\e801'}.icon-stats:before{content:'\e802'}.icon-tags:before{content:'\e803'}.icon-like:before{content:'\e804'}.icon-cog-alt:before{content:'\e805'}.icon-project:before{content:'\e806'}.icon-mooc:before{content:'\e807'}.icon-dl:before{content:'\e808'}.icon-ml:before{content:'\e809'}.icon-python:before{content:'\e80a'}.icon-nlp:before{content:'\e80b'}.icon-r-lang:before{content:'\e80c'}.icon-skill:before{content:'\e80d'}.icon-js-solid:before{content:'\e80e'}.icon-game:before{content:'\e80f'}.icon-web:before{content:'\e810'}.icon-algo:before{content:'\e811'}.icon-mooc-solid:before{content:'\e812'}.icon-chatbot:before{content:'\e813'}.icon-web-dev:before{content:'\e814'}.icon-data:before{content:'\e815'}.icon-skill-solid:before{content:'\e816'}.icon-python-solid:before{content:'\e817'}.icon-project-solid:before{content:'\e818'}.icon-js:before{content:'\e819'}.icon-rocket:before{content:'\e81a'}.icon-ml-solid:before{content:'\e81b'}.icon-game-solid:before{content:'\e81c'}.icon-dl-solid:before{content:'\e81d'}.icon-nlp-solid:before{content:'\e81e'}.icon-web-solid:before{content:'\e81f'}.icon-algo-solid:before{content:'\e820'}.icon-puzzle-outline:before{content:'\e821'}.icon-ng:before{content:'\e822'}.icon-ok:before{content:'\e823'}.icon-link:before{content:'\e824'}.icon-down-circle:before{content:'\e826'}.icon-api:before{content:'\e828'}.icon-right-circle:before{content:'\e829'}.icon-down-open:before{content:'\e82a'}.icon-right-open:before{content:'\e82b'}.icon-copy:before{content:'\f0c5'}.icon-gamepad:before{content:'\f11b'}.icon-fork:before{content:'\f126'}.icon-mlops-solid:before{content:'\f135'}.icon-edu-solid:before{content:'\f19d'}.icon-others-solid:before{content:'\f1b3'}.icon-ds-solid:before{content:'\f1c0'}.icon-chart-area:before{content:'\f1fe'}.icon-chart-pie:before{content:'\f200'}.icon-ts:before{content:'\f201'}.icon-clone:before{content:'\f24d'}</style><body><script>function showTheme() {
        const btn = document.getElementById("toggle-dark-light");
        let toggleIcon = btn.firstElementChild;
        const currentTheme = localStorage.getItem("theme");
        if (currentTheme === "dark") {
          document
            .body
            .classList
            .toggle("dark-theme");
          toggleIcon.src = "/img_src/nav/sun.svg";
        } else if (currentTheme === "light") {
          document
            .body
            .classList
            .toggle("light-theme");
          toggleIcon.src = "/img_src/nav/moon.svg";
        }
      }
      function showContent() {
        document.body.style.visibility = 'visible';
        document.body.style.opacity = 1;
      }
      window.addEventListener('DOMContentLoaded', (event) => {
        showTheme();
        showContent();
      });</script><header class="wave-border wave-border-post"><nav><div id=nav><a href=/ class="nav-item no-effect"><img alt=home class=keep-original src=/img_src/nav/home.svg height=18 width=18> <span>Thi</span> </a><a href=/about/ class="nav-item no-effect"><img alt=about class=keep-original src=/img_src/nav/about.svg height=15 width=15> <span>About</span></a><div class=nav-search id=nav-search><form><input aria-label='search notes (press "/" to focus & "ESC" to lose)' autocomplete=off class=nav-search__input id=nav-search__input onfocusin=inFocus(this) placeholder='search notes (press "/" to focus & "ESC" to lose)' type=search></form><div id=nav-search__result-container style="display: none;"><ul id=nav-search__ul></ul><div id=nav-search__no-result style="display: none;"><p>No results found.</div></div></div><span class="nav-item no-effect nav-dark-light" href="" id=toggle-dark-light><img alt=light-mode class=keep-original src=/img_src/nav/moon.svg height=20 width=20> </span><a href=https://github.com/dinhanhthi class="nav-item no-effect nav-github" target=_blank><img alt=github class=keep-original src=/img_src/nav/github.svg height=20 width=20></a></div><div class=reading-progress-container><div id=reading-progress aria-hidden=true></div></div></nav><script>var divNavSearch=document.getElementById("nav-search"),divRes=document.getElementById("nav-search__result-container"),ulRes=document.getElementById("nav-search__ul");function inFocus(e){""!=e.value&&(divRes.style.display="block")}var isOnDiv=!1;divRes.addEventListener("mouseover",(function(){isOnDiv=!0})),divRes.addEventListener("mouseout",(function(){isOnDiv=!1}));var inputSearch=document.getElementById("nav-search__input");window.addEventListener("click",(function(){ulRes.getElementsByTagName("li").length>=1&&isOnDiv||(divRes.style.display="none")})),inputSearch.addEventListener("click",(e=>{e.stopPropagation()}));const addSelected=e=>{ulRes.querySelectorAll("li").forEach((e=>{e.classList.remove("selected")})),e.classList.add("selected")};var isInView=(e,t)=>{var n=e.offsetTop+e.offsetHeight-t.scrollTop>t.offsetHeight;return e.offsetTop<t.scrollTop?"above":n?"below":"in"};const updateScroll=(e,t)=>{e.offsetTop+e.offsetHeight-t.scrollTop>t.offsetHeight&&(t.scrollTop=e.offsetTop+e.offsetHeight-t.offsetHeight),e.offsetTop<t.scrollTop&&(t.scrollTop=e.offsetTop)};document.onkeydown=e=>{checkInInput=document.activeElement==inputSearch,"/"!==e.key||checkInInput||(e.stopPropagation(),e.preventDefault(),inputSearch.focus())},document.addEventListener("focusin",(e=>{divNavSearch.contains(e.target)||(divRes.style.display="none")})),inputSearch.onkeydown=e=>{if("Enter"===e.key){e.stopPropagation(),e.preventDefault();var t=ulRes.querySelector('li[class*="selected"]');window.location.href=t.getElementsByClassName("item__content")[0].firstChild.firstChild.href}"Escape"===e.key&&(divRes.style.display="none",inputSearch.blur())},divNavSearch.onkeydown=e=>{if(hasResult=ulRes.getElementsByTagName("li").length>=1,hasResult){["ArrowUp","ArrowDown"].indexOf(e.key)>-1&&e.preventDefault();var t=ulRes.firstChild,n=ulRes.lastChild,s=ulRes.querySelector('li[class*="selected"]');switch(e.key){case"ArrowUp":nextLi=s&&s!=t?s.previousSibling:n,addSelected(nextLi),s=nextLi,updateScroll(s,divRes);break;case"ArrowDown":nextLi=s&&s!=n?s.nextSibling:t,addSelected(nextLi),s=nextLi,updateScroll(s,divRes)}}};</script><div class=header-container><div class="header-logo post-layout"><img alt="Data Aggregation" class=keep-original src=/img/header/aggregation.png height=55 width=55></div><h1>Data Aggregation</h1><div id=more-info><div id=note-tag><a href=/tags/data-science/ id=category }>Data Science</a></div><div id=last-modified>Last modified 2 years ago / <a href=https://github.com/dinhanhthi/notes/edit/master/./posts/data-science/2019-12-07-data-aggregation.md>Edit on Github</a></div></div></div></header><main class="" id=main-wrapper><article class=post-container><div class="container mt-2 normal page-note"><div class="danger not-full-warning"><div class=warning-icon><img alt=Warning class=keep-original src=/img_src/icons/time.svg></div><div>This post was <strong>updated more than 1 year ago</strong>, some information may be outdated!</div></div><div class="toc toc-common toc-js"><div class=ol-container><div class=toc-heading>In this note</div><ol><li><a href=#libraries>Libraries</a><li><a href=#dataframe>Dataframe</a><li><a href=#group-dataset-using-groupby()>Group dataset using groupby()</a><li><a href=#group-using-pivot_table()>Group using pivot_table()</a><li><a href=#reorganizing-df-using-pivot()>Reorganizing df using pivot()</a><li><a href=#change-shape-of-df-with-melt()>Change shape of df with melt()</a><li><a href=#references>References</a></ol></div></div><p>In this note, I use <code>df</code> for <code>DataFrame</code>, <code>s</code> for <code>Series</code>.<h2 id=libraries tabindex=-1>Libraries <a href=#libraries class=direct-link aria-hidden=true><i class="fontello-icon icon-link"></i></a></h2><pre class=language-python><code class=language-python><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd <span class="token comment"># import pandas package</span><br><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</code></pre><h2 id=dataframe tabindex=-1>Dataframe <a href=#dataframe class=direct-link aria-hidden=true><i class="fontello-icon icon-link"></i></a></h2><pre class=language-python><code class=language-python>dataquest_aio <span class="token operator">=</span> <span class="token string">'https://raw.githubusercontent.com/dinhanhthi/dataquest-aio/master/step-2-data-analysis-and-visualization/'</span><br>dataset_url <span class="token operator">=</span> dataquest_aio <span class="token operator">+</span> <span class="token string">'course-4-data-cleaning-and-analysis/data/World_Happiness_2015.csv'</span><br>df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>dataset_url<span class="token punctuation">)</span> <span class="token comment"># read the data set</span><br>df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><table><thead><tr><th><th>Country<th>Region<th>Happiness Rank<th>Happiness Score<th>Standard Error<tbody><tr><th>0<td>Switzerland<td>Western Europe<td>1<td>7.587<td>0.03411<tr><th>1<td>Iceland<td>Western Europe<td>2<td>7.561<td>0.04884<tr><th>2<td>Denmark<td>Western Europe<td>3<td>7.527<td>0.03328<tr><th>3<td>Norway<td>Western Europe<td>4<td>7.522<td>0.03880<tr><th>4<td>Canada<td>North America<td>5<td>7.427<td>0.03553</table><h2 id=group-dataset-using-groupby() tabindex=-1>Group dataset using <code>groupby()</code> <a href=#group-dataset-using-groupby() class=direct-link aria-hidden=true><i class="fontello-icon icon-link"></i></a></h2><p>Group <code>df</code> by column <code>Region</code> and then selct the column <code>Western Europe</code>,<pre class=language-python><code class=language-python>df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'Region'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_group<span class="token punctuation">(</span><span class="token string">'Western Europe'</span><span class="token punctuation">)</span> <span class="token comment"># returns a df</span></code></pre><table><thead><tr><th><th>Country<th>Region<th>Happiness Rank<th>Happiness Score<th>Standard Error<tbody><tr><th>0<td>Switzerland<td>Western Europe<td>1<td>7.587<td>0.03411<tr><th>1<td>Iceland<td>Western Europe<td>2<td>7.561<td>0.04884<tr><th>2<td>Denmark<td>Western Europe<td>3<td>7.527<td>0.03328<tr><th>3<td>Norway<td>Western Europe<td>4<td>7.522<td>0.03880<tr><th>5<td>Finland<td>Western Europe<td>6<td>7.406<td>0.03140</table><p>Select just the <code>Happiness Score</code> column and then find the <code>mean</code>,<pre class=language-python><code class=language-python>df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'Region'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'Happiness Score'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token comment"># other methods: size, max, min, count</span></code></pre><pre><code>Region
Australia and New Zealand          7.285000
Central and Eastern Europe         5.332931
Eastern Asia                       5.626167
Latin America and Caribbean        6.144682
Middle East and Northern Africa    5.406900
North America                      7.273000
Southeastern Asia                  5.317444
Southern Asia                      4.580857
Sub-Saharan Africa                 4.202800
Western Europe                     6.689619
Name: Happiness Score, dtype: float64
</code></pre><p>Apply multiple/custom functions,<pre class=language-python><code class=language-python><span class="token keyword">def</span> <span class="token function">max_min</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">:</span><br>  <span class="token keyword">return</span> group<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> group<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Country'</span><span class="token punctuation">,</span> <span class="token string">'Region'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">,</span> np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">,</span> max_min<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><table><thead><tr><th><th><th colspan=3 halign=left>Happiness Rank<th colspan=3 halign=left>Happiness Score<tr><th><th><th>mean<th>amax<th>max_min<th>mean<th>amax<th>max_min<tr><th>Country<th>Region<th><th><th><th><th><th><tbody><tr><th>Afghanistan<th>Southern Asia<td>153<td>153<td>0<td>3.575<td>3.575<td>0.0<tr><th>Albania<th>Central Europe<td>95<td>95<td>0<td>4.959<td>4.959<td>0.0<tr><th>Algeria<th>Middle Africa<td>68<td>68<td>0<td>5.605<td>5.605<td>0.0</table><p>If you wanna apply different functions on different columns,<pre class=language-python><code class=language-python>df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Country'</span><span class="token punctuation">,</span> <span class="token string">'Region'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">{</span><br>    <span class="token string">'Happiness Rank'</span><span class="token punctuation">:</span> max_min<span class="token punctuation">,</span><br>    <span class="token string">'Happiness Score'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'min'</span><span class="token punctuation">,</span> <span class="token string">'max'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>    <span class="token string">'Standard Error'</span><span class="token punctuation">:</span> <span class="token string">'count'</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span></code></pre><table><thead><tr><th><th><th>Happiness Rank<th colspan=2 halign=left>Happiness Score<tr><th><th><th>max_min<th>min<th>max<tr><th>Country<th>Region<th><th><th><tbody><tr><th>Afghanistan<th>Southern Asia<td>0<td>3.575<td>3.575<tr><th>Albania<th>Central Europe<td>0<td>4.959<td>4.959<tr><th>Algeria<th>Middle Africa<td>0<td>5.605<td>5.605</table><p>Or using <code>apply</code> and <code>lambda</code> function,<pre class=language-python><code class=language-python>orders<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'shoes'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>price<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> np<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h2 id=group-using-pivot_table() tabindex=-1>Group using <code>pivot_table()</code> <a href=#group-using-pivot_table() class=direct-link aria-hidden=true><i class="fontello-icon icon-link"></i></a></h2><p><img alt="An example of pivotting by a single column" class=img-90 src=/img/post/data/data-aggregation/pivoting_table_simple1.png><br><em>An example of pivotting by a single column<sup><a href=https://nikgrozev.com/2015/07/01/reshaping-in-pandas-pivot-pivot-table-stack-and-unstack-explained-with-pictures/ >[ref]</a></sup></em><p>Group by <code>Region</code> (as an index) and choosing <code>GDP</code> and <code>City</code> columns,<sup><a href=https://github.com/dinhanhthi/data-science-learning/blob/master/codecademy-data-science/course-10%20Data%20Analysis%20with%20Pandas/Aggregates%20in%20Pandas.ipynb target=_blank rel="noopener noreferrer">[ref]</a></sup><pre class=language-python><code class=language-python>df<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>values<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GDP'</span><span class="token punctuation">,</span> <span class="token string">'City'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token string">'Region'</span><span class="token punctuation">)</span> <span class="token comment"># returns df</span></code></pre><table><thead><tr><th><th>Happiness Rank<th>Standard Error<tr><th>Region<th><th><tbody><tr><th>Australia and New Zealand<td>9.5<td>0.037270<tr><th>Central and Eastern Europe<td>79.0<td>0.045208<tr><th>Eastern Asia<td>64.5<td>0.037225</table><p>Apply some functions,<pre class=language-python><code class=language-python>df<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'GDP'</span><span class="token punctuation">,</span> <span class="token string">'City'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'Region'</span><span class="token punctuation">,</span> aggfunc<span class="token operator">=</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">,</span> np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">]</span><span class="token punctuation">,</span> margins<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><br><span class="token comment"># margins shows the "All" row</span></code></pre><table><thead><tr><th><th colspan=2 halign=left>mean<th colspan=2 halign=left>amax<tr><th><th>Happiness Rank<th>Standard Error<th>Happiness Rank<th>Standard Error<tr><th>Region<th><th><th><th><tbody><tr><th>Australia and New Zealand<td>9.5<td>0.037270<td>10<td>0.04083<tr><th>Central and Eastern Europe<td>79.0<td>0.045208<td>134<td>0.06913<tr><th>Eastern Asia<td>64.5<td>0.037225<td>100<td>0.05051</table><h2 id=reorganizing-df-using-pivot() tabindex=-1>Reorganizing df using <code>pivot()</code> <a href=#reorganizing-df-using-pivot() class=direct-link aria-hidden=true><i class="fontello-icon icon-link"></i></a></h2><p><img alt="An example of multi-column pivoting" class=img-90 src=/img/post/data/data-aggregation/pivoting_simple_multicolumn.png><br><em>An example of multi-column pivoting (<a href=https://nikgrozev.com/2015/07/01/reshaping-in-pandas-pivot-pivot-table-stack-and-unstack-explained-with-pictures/ >ref</a>)</em><p>Make values in one columns be columns in a new "pivot" table,<sup><a href=https://github.com/dinhanhthi/data-science-learning/blob/master/codecademy-data-science/course-10%20Data%20Analysis%20with%20Pandas/Aggregates%20in%20Pandas.ipynb target=_blank rel="noopener noreferrer">[ref]</a></sup><pre class=language-python><code class=language-python>df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'foo'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span><br>                           <span class="token string">'two'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>                   <span class="token string">'bar'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>                   <span class="token string">'baz'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>                   <span class="token string">'zoo'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'q'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> <span class="token string">'t'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>pivot_1 <span class="token operator">=</span> df<span class="token punctuation">.</span>pivot<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">'foo'</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token string">'bar'</span><span class="token punctuation">,</span> values<span class="token operator">=</span><span class="token string">'baz'</span><span class="token punctuation">)</span><br>pivot_2 <span class="token operator">=</span> df<span class="token punctuation">.</span>pivot<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">'foo'</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'baz'</span><span class="token punctuation">]</span><br>pivot_3 <span class="token operator">=</span> df<span class="token punctuation">.</span>pivot<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">'foo'</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token string">'bar'</span><span class="token punctuation">,</span> values<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'baz'</span><span class="token punctuation">,</span> <span class="token string">'zoo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br><br>display_side_by_side<span class="token punctuation">(</span>df<span class="token punctuation">,</span> pivot_1<span class="token punctuation">,</span> pivot_2<span class="token punctuation">,</span> pivot_3<span class="token punctuation">)</span></code></pre><table><thead><tr><th><th>foo<th>bar<th>baz<th>zoo<tbody><tr><th>0<td>one<td>A<td>1<td>x<tr><th>1<td>one<td>B<td>2<td>y<tr><th>2<td>one<td>C<td>3<td>z<tr><th>3<td>two<td>A<td>4<td>q<tr><th>4<td>two<td>B<td>5<td>w<tr><th>5<td>two<td>C<td>6<td>t</table><div class="col-2-flex flex-start"><table><thead><tr><th>bar<th>A<th>B<th>C<tr><th>foo<th><th><th><tbody><tr><th>one<td>1<td>2<td>3<tr><th>two<td>4<td>5<td>6</table><table><thead><tr><th>bar<th>A<th>B<th>C<tr><th>foo<th><th><th><tbody><tr><th>one<td>1<td>2<td>3<tr><th>two<td>4<td>5<td>6</table><table><thead><tr><th><th colspan=3 halign=left>baz<th colspan=3 halign=left>zoo<tr><th>bar<th>A<th>B<th>C<th>A<th>B<th>C<tr><th>foo<th><th><th><th><th><th><tbody><tr><th>one<td>1<td>2<td>3<td>x<td>y<td>z<tr><th>two<td>4<td>5<td>6<td>q<td>w<td>t</table></div><p>For one who wanna know <code>display_side_by_side</code>, check <a href=/jupyter-notebook#display-dataframes-side-by-side>this note</a>.<h2 id=change-shape-of-df-with-melt() tabindex=-1>Change shape of df with <code>melt()</code> <a href=#change-shape-of-df-with-melt() class=direct-link aria-hidden=true><i class="fontello-icon icon-link"></i></a></h2><p>Contrary to <code>pivot</code>, we now want to transform several columns into values of a single column,<sup><a href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.melt.html target=_blank rel="noopener noreferrer">[ref]</a></sup><pre class=language-python><code class=language-python>df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'A'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token string">'c'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>                   <span class="token string">'B'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>                   <span class="token string">'C'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>melt<span class="token punctuation">(</span>df<span class="token punctuation">,</span> id_vars<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> value_vars<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>melt<span class="token punctuation">(</span>df<span class="token punctuation">,</span> id_vars<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> value_vars<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br><br>display_side_by_side<span class="token punctuation">(</span>df<span class="token punctuation">,</span> df1<span class="token punctuation">,</span> df2<span class="token punctuation">)</span></code></pre><div class="col-2-flex flex-start"><table><thead><tr><th><th>A<th>B<th>C<tbody><tr><th>0<td>a<td>1<td>2<tr><th>1<td>b<td>3<td>4<tr><th>2<td>c<td>5<td>6</table><table><thead><tr><th><th>A<th>variable<th>value<tbody><tr><th>0<td>a<td>B<td>1<tr><th>1<td>b<td>B<td>3<tr><th>2<td>c<td>B<td>5</table><table><thead><tr><th><th>A<th>variable<th>value<tbody><tr><th>0<td>a<td>B<td>1<tr><th>1<td>b<td>B<td>3<tr><th>2<td>c<td>B<td>5<tr><th>3<td>a<td>C<td>2<tr><th>4<td>b<td>C<td>4<tr><th>5<td>c<td>C<td>6</table></div><h2 id=references tabindex=-1>References <a href=#references class=direct-link aria-hidden=true><i class="fontello-icon icon-link"></i></a></h2><ul><li><a href=https://github.com/dinhanhthi/dataquest-aio/tree/master/step-2-data-analysis-and-visualization/course-4-data-cleaning-and-analysis>Data Cleaning and Analysis</a> on Dataquest.<li><a href=https://dinhanhthi.github.io/tools/github-html?https://github.com/dinhanhthi/dataquest-aio/blob/master/step-2-data-analysis-and-visualization/course-4-data-cleaning-and-analysis/notebooks_in_html/task-3-transforming-data-with-pandas.html>Transforming data with pandas</a> on Dataquest.<li><strong>pandas official</strong> -- <a href=https://pandas.pydata.org/pandas-docs/stable/user_guide/groupby.html>Group By: split-apply-combine</a></ul></div><script type=application/ld+json>{
        "@context": "https://schema.org",
        "@type": "Article",
        "headline": "Data Aggregation",
        "image": [],
        "author": "Anh-Thi DINH",
        "url": "https://dinhanhthi.com/data-aggregation/",
        "mainEntityOfPage": "https://dinhanhthi.com/data-aggregation/",
        "datePublished": "07-12-2019",
        "dateModified": "2019-12-07",
        "description": "In this note, I use df for DataFrame, s for Series. Libraries import pandas as pd # import pandas packageimport numpy as np Dataframe..."
      }</script></article></main><footer><a href=/ target=_blank>Thi Â Â©Â  2022 </a>Â â€¢Â  <a href=/about-the-notes/ >About this site </a>Â â€¢Â  <a href=https://photos.app.goo.gl/9OVEkdTjmtRPg7vC3 target=_blank>My sketches </a>Â â€¢Â  <a href=https://goo.gl/photos/yQXdQws1LLS16x5v5 target=_blank>I cook </a>Â â€¢Â  <a href=/support-thi/ ><img alt="Support Thi" class=keep-original src=/img_src/icons/coffee.svg height=16 width=auto> Support Thi</a></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/elasticlunr/0.9.6/elasticlunr.min.js></script><script src=/src/js/components/clipboard.min.js></script><script src="/src/js/main.min.js?hash=d3b51a19b7" async defer></script><a href=/support-thi/ class="floating-button tooltip" id=buy-me-a-coffee><img alt="Support Thi" class=keep-original src=/img_src/icons/coffee.svg> <span class=tooltiptext>Support Thi</span> </a><button class="floating-button tooltip" id=scroll-top-btn><img alt="Scroll to top" class=keep-original src=/img_src/to-top.webp> <span class=tooltiptext>Top</span></button>